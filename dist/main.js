!function(){"use strict";class t{constructor(t){this.allCards=[],this.container=document.querySelector(t),this.mouseX=void 0,this.mouseY=void 0,this.draggbleEl=void 0,this.dropEl=void 0,this.container.addEventListener("dragenter",(t=>{let e,s;this.dropEl=t.target;const a=this.dropEl.getBoundingClientRect();if(!this.dropEl.classList.contains("selected")){const r=a.y+a.height;(t.clientY>r&&t.target.classList.contains("list-item")||r>t.clientY&&t.target.classList.contains("list-item"))&&(s=this.dropEl.closest(".list-item"),e=s.closest(".list"),e.insertBefore(this.draggbleEl,s))}void 0===this.dropEl||this.dropEl.classList.contains("list-item")||(e=this.dropEl.closest(".list"),e&&e.appendChild(this.draggbleEl))})),this.onMouseUp=t=>{t.target.classList.contains("list-item")&&this.draggbleEl&&this.draggbleEl.classList.remove("selected")},this.dragFunc=t=>{this.draggbleEl=t.target,this.draggbleEl.classList.add("selected")},this.dragFuncOver=t=>{if(this.draggbleEl){const t=this.draggbleEl.closest(".list").getAttribute("data-column");this.allCards.forEach((e=>{e.id===this.draggbleEl.getAttribute("cardid")&&(e.column=t)})),this.draggbleEl.classList.remove("selected"),this.draggbleEl.removeAttribute("style"),this.draggbleEl=void 0,this.toLocalStorage()}},this.removeCard=t=>{t.target.classList.contains("card-close-block")&&(t.preventDefault(),t.stopPropagation(),this.allCards=this.allCards.filter((e=>e.id!==t.target.getAttribute("closeId"))),this.rebuildDom())},this.hoverCard=t=>{if(t.target.classList.contains("list-item")){const e=t.target.getAttribute("cardId"),s=this.allCards.find((t=>t.id===e));s.close.removeEventListener(s.tag,this.hoverCardOff),s.close.classList.remove("hidden")}},this.hoverCardOff=t=>{if(t.target.classList.contains("list-item")){const e=t.target.getAttribute("cardId"),s=this.allCards.find((t=>t.id===e));s.close.removeEventListener(s.tag,this.hoverCard),s.close.classList.add("hidden")}}}createCard(t,e){if("false"===e.getAttribute("data-active"))return;const s=performance.now().toFixed(),a=document.createElement("li"),r=document.createElement("p"),i=document.createElement("div"),d=this.createForm(s);r.textContent=t,a.classList.add("list-item"),a.setAttribute("draggable",!0),a.setAttribute("cardId",s),i.setAttribute("closeId",s),i.classList.add("card-close-block"),i.addEventListener("click",this.removeCard),i.classList.add("hidden"),a.appendChild(r),a.appendChild(i),a.addEventListener("mouseover",this.hoverCard),a.addEventListener("mouseup",this.onMouseUp),a.addEventListener("mouseleave",this.hoverCardOff),a.addEventListener("mousedown",this.dragFunc),a.addEventListener("dragend",this.dragFuncOver);const o={id:s,text:t,tag:a,close:i,column:e.getAttribute("data-column"),form:d};this.allCards.push(o);const l=e.closest(".list-container");return this.showForm(l,o.form),e.setAttribute("data-active",!1),o}rebuildDom(){document.querySelectorAll(".list-item").forEach((t=>{t.classList.contains("unmovable")||(t.removeEventListener("click",this.removeCard),t.removeEventListener("mouseover",this.hoverCard),t.removeEventListener("mouseleave",this.hoverCardOff),t.removeEventListener("mousedown",this.dragFunc),t.removeEventListener("dragend",this.dragFuncOver),t.removeEventListener("mouseup",this.onMouseUp),t.remove())})),this.allCards.forEach((t=>{const e=document.querySelector(`.${t.column}-list`);t.tag.textContent=t.text,t.tag.appendChild(t.close),t.tag.addEventListener("mouseover",this.hoverCard),t.tag.addEventListener("mouseleave",this.hoverCardOff),t.tag.addEventListener("mousedown",this.dragFunc),t.tag.addEventListener("dragend",this.dragFuncOver),t.tag.addEventListener("mouseup",this.onMouseUp),e.appendChild(t.tag)})),this.toLocalStorage()}toLocalStorage(){const t=[];this.allCards.forEach((e=>{t.push({id:e.id,tagClass:e.tag.getAttribute("class"),column:e.column,text:e.text,closeTag:e.close.getAttribute("closeid")})})),localStorage.setItem("cards",JSON.stringify(t))}restoreCardsStorage(t){t.forEach((t=>{const e=t.id,s=document.createElement("li"),a=document.createElement("p"),r=document.createElement("div"),i=document.querySelector(`.${t.column}-list`);s.classList.add(t.tagClass),s.setAttribute("draggable",!0),s.setAttribute("cardId",e),r.setAttribute("closeId",e),r.classList.add("card-close-block"),r.addEventListener("click",this.removeCard),r.classList.add("hidden"),a.textContent=t.text,s.appendChild(r),s.appendChild(a),s.addEventListener("mouseover",this.hoverCard),s.addEventListener("mouseleave",this.hoverCardOff),s.addEventListener("mousedown",this.dragFunc),s.addEventListener("dragend",this.dragFuncOver),s.addEventListener("mouseup",this.onMouseUp);const d={id:e,text:t.text,tag:s,close:r,column:t.column};this.allCards.push(d),i.appendChild(d.tag)}))}createForm(t){this.id=t;const e=document.createElement("form");return e.setAttribute("formId",this.id),e.classList.add("add-card"),e.innerHTML=`<textarea name="card-title" class="card-title-field" rows = "5" placeholder="Enter a text for this card..."></textarea>\n                    <div class="input-container">\n                      <div class="input-block">\n                          <input type="submit" value="Add Card" class="input-add-card" data-cardId=${this.id}>\n                             <div class="close-btn">\n                        </div>\n                    </div>\n                    <div class="menu-block">\n                      </div>\n                  </div>`,e}showForm(t,e){const s=e.querySelector(".input-add-card"),a=e.querySelector("textarea");t.appendChild(e),s.addEventListener("click",(s=>{if(s.preventDefault(),!a.value)return this.showForm(t,e);if(a.value){const t=e.getAttribute("formId");this.allCards.forEach((s=>{s.id===t&&(s.text=a.value,e.remove(),this.rebuildDom())}))}}))}}window.addEventListener("DOMContentLoaded",(()=>{const e=new t(".container"),s=document.querySelectorAll(".add-card-container");if(null!==localStorage.getItem("cards"))try{const t=JSON.parse(localStorage.getItem("cards"));t.forEach((t=>{t.id&&t.column&&t.text&&t.closeTag&&"list-item"===t.tagClass||localStorage.clear()})),e.restoreCardsStorage(t),e.toLocalStorage()}catch(t){localStorage.clear()}else localStorage.clear();s.forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault();const s=t.target,a=s.getAttribute("data-active");"false"==a?0===Array.from(document.querySelectorAll(".add-card")).length&&(s.setAttribute("data-active",!0),e.createCard("demo",t.target)):"true"===a&&s.setAttribute("data-active",!1)}))}))}))}();